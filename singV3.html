<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sight-Singing Trainer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
  <link rel="stylesheet" href="./src/css/pages/sing-v3.css">
</head>
<body>

<!-- ── APP BAR ──────────────────────────────────────── -->
<header class="app-bar">
  <div class="app-bar-inner">
    <div class="app-title-wrap">
      <span class="app-title">Sight-Singing Trainer</span>
      <span class="app-tagline hidden sm:inline">Notenlesen · Gehör · Singen</span>
    </div>
    <nav class="nav-tabs">
      <button id="navDashboardBtn" class="nav-btn active">Dashboard</button>
      <button id="navPracticeBtn" class="nav-btn">Üben</button>
      <button id="navSettingsBtn" class="nav-btn">Einstellungen</button>
    </nav>
  </div>
</header>

<div class="page-content">

  <!-- ── DASHBOARD ──────────────────────────────────── -->
  <section id="dashboardScreen" class="screen active space-y-5">

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

      <!-- Primary CTA -->
      <div class="dashboard-hero md:col-span-2">
        <div class="eyebrow">Geführtes Programm</div>
        <div class="hero-title">Nächste Session starten</div>
        <p id="dashboardSummary" class="hero-body">Lade Fortschritt…</p>
        <button id="startGuidedBtn" class="hero-btn">
          <svg class="icon icon-14" aria-hidden="true">
            <use href="./src/assets/icons.svg#icon-play"></use>
          </svg>
          Session starten
        </button>
      </div>

      <!-- Sidebar -->
      <div class="dashboard-sidebar">
        <div class="side-card side-card-grow">
          <div class="section-label">Letzte Sessions</div>
          <div id="recentSessionsContainer" class="text-sm text-slate-500 space-y-1.5"></div>
        </div>
        <div class="custom-card">
          <div class="section-label section-label-accent">Eigene Übung</div>
          <p class="custom-card-copy">
            Wähle Skill, Level und Anzahl frei.
          </p>
          <button id="goCustomFromDashboardBtn" class="btn-custom-primary">
            Benutzerdefiniert
          </button>
        </div>
      </div>

    </div>

    <!-- Skill Map -->
    <div class="card card-padded">
      <div class="section-label">Skill Map</div>
      <div id="skillMapContainer" class="grid grid-cols-1 md:grid-cols-2 gap-2"></div>
    </div>

  </section>

  <!-- ── PRACTICE ────────────────────────────────────── -->
  <section id="practiceScreen" class="screen space-y-3">

    <!-- Config strip -->
    <div class="config-strip">
      <div class="grid grid-cols-2 md:grid-cols-6 gap-3 items-end">
        <div>
          <span class="config-label">Familie</span>
          <select id="familySelect" class="config-select"></select>
        </div>
        <div>
          <span class="config-label">Skill</span>
          <select id="skillSelect" class="config-select"></select>
        </div>
        <div>
          <span class="config-label">Schlüssel</span>
          <select id="clefSelect" class="config-select"></select>
        </div>
        <div>
          <span class="config-label">Level</span>
          <select id="levelSelect" class="config-select"></select>
        </div>
        <div>
          <span class="config-label">Anzahl</span>
          <input id="countInput" type="number" min="1" max="50" value="10" class="config-input" />
        </div>
        <div>
          <button id="startCustomBtn" class="btn-custom-primary btn-custom-compact">
            Start
          </button>
        </div>
      </div>
    </div>

    <!-- Session bar -->
    <div class="session-bar">
      <div class="session-bar-header">
        <p id="sessionMeta" class="session-meta">Keine aktive Session</p>
        <button id="endSessionBtn" class="btn-action btn-ghost">Session beenden</button>
      </div>
      <div class="progress-track">
        <div id="sessionProgressBar" class="progress-fill"></div>
      </div>
    </div>

    <!-- Exercise area -->
    <div class="exercise-card exercise-card-stack">
      <h2 id="exercisePrompt" class="exercise-prompt exercise-prompt-reset">Wähle oben eine Übung aus</h2>

      <div id="standardExerciseBlock">
        <p id="exerciseSubPrompt" class="exercise-subprompt"></p>
        <p id="rhythmDisplay" class="rhythm-display"></p>
        <div>
          <svg id="practiceStaff" viewBox="0 0 800 180" class="staff-svg"></svg>
        </div>
        <div id="answerOptions" class="flex flex-wrap gap-2 answer-options"></div>
      </div>

      <!-- Melody trainer panel -->
      <div id="melodyTrainerPanel" class="hidden melody-panel space-y-3">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="melody-inner-card">
            <h3 class="melody-section-title">Erste Note (Melodie)</h3>
            <label class="flex items-center gap-2 text-sm melody-start-note-option"><input type="radio" name="startNote" value="random" checked> Zufällig</label>
            <label class="flex items-center gap-2 text-sm melody-start-note-option"><input type="radio" name="startNote" value="C2"> C2</label>
            <label class="flex items-center gap-2 text-sm melody-start-note-option"><input type="radio" name="startNote" value="C4"> C4</label>
          </div>
          <div class="melody-inner-card">
            <h3 class="melody-section-title">Erlaubte Intervalle</h3>
            <div class="grid grid-cols-2 gap-1 text-sm">
              <label class="flex items-center gap-2"><input type="checkbox" name="interval" value="0" checked> Prime</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="interval" value="1" checked> Sekunde</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="interval" value="2" checked> Terz</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="interval" value="3"> Quarte</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="interval" value="4"> Quinte</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="interval" value="5"> Sexte</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="interval" value="6"> Septime</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="interval" value="7"> Oktave</label>
            </div>
          </div>
        </div>

        <div class="melody-inner-card melody-toolbar">
          <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="visualMetronomeToggle"> Visueller Metronom</label>
          <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="liveFeedbackToggle"> Live-Feedback</label>
          <div id="visualMetronomeIndicator" class="metro-indicator"></div>
          <label for="bpmInput" class="bpm-label">BPM</label>
          <input type="number" id="bpmInput" min="40" max="240" value="90" class="bpm-input" />
        </div>

        <div class="staff-scroll">
          <div class="staff-caption">Generierte Melodie</div>
          <svg id="staffSvg" width="800" height="180" class="staff-svg staff-centered-svg"></svg>
        </div>
        <div class="staff-scroll">
          <div class="staff-caption">Aufgenommene Melodie</div>
          <svg id="recordedStaffSvg" width="800" height="180" class="staff-svg staff-centered-svg"></svg>
        </div>

        <div class="melody-actions">
          <button id="generateNotesBtn" class="btn-action btn-melody-generate">Neue Melodie</button>
          <button id="playNotesBtn" class="btn-action btn-play">Melodie abspielen</button>
          <button id="recordBtn" class="btn-action btn-record">Aufnahme starten</button>
          <button id="stopBtn" class="btn-action btn-next">Stopp</button>
        </div>

        <p id="messageBox" class="message-box"></p>
        <p id="detectedNoteDebug" class="note-debug"></p>

        <div class="hidden">
          <button id="continuousDetectionBtn">Fortlaufende Notenerkennung starten</button>
          <span id="detectionStatus">Inaktiv</span>
          <span id="detectedFrequency">-</span>
          <span id="detectedNoteName">-</span>
        </div>
      </div>

      <!-- Action row -->
      <div class="exercise-action-row">
        <button id="playPromptBtn" class="btn-action btn-play">
          <svg class="icon icon-13" aria-hidden="true">
            <use href="./src/assets/icons.svg#icon-play"></use>
          </svg>
          Prompt abspielen
        </button>
        <button id="capturePitchBtn" class="btn-action btn-record">
          <svg class="icon icon-12" aria-hidden="true">
            <use href="./src/assets/icons.svg#icon-record"></use>
          </svg>
          Singen aufnehmen
        </button>
        <button id="nextExerciseBtn" class="btn-action btn-next">
          Nächste Übung
          <svg class="icon icon-13" aria-hidden="true">
            <use href="./src/assets/icons.svg#icon-next"></use>
          </svg>
        </button>
      </div>

      <p id="exerciseFeedback" class="exercise-feedback"></p>
    </div>

    <!-- Session summary -->
    <div id="sessionSummaryPanel" class="summary-card hidden">
      <div class="section-label">Session abgeschlossen</div>
      <p id="sessionSummaryText" class="summary-text"></p>
      <button id="backToDashboardBtn" class="btn-action btn-primary">Zum Dashboard</button>
    </div>

  </section>

  <!-- ── SETTINGS ────────────────────────────────────── -->
  <section id="settingsScreen" class="screen">
    <div class="settings-card">
      <div class="section-label">Einstellungen</div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-2">
        <div>
          <h2 class="settings-section-title">Schlüssel</h2>
          <label class="flex items-center gap-2 text-sm settings-clef-option"><input type="checkbox" id="settingClefTreble" /> Violinschlüssel (Treble)</label>
          <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="settingClefBass" /> Bassschlüssel (Bass)</label>
        </div>
        <div>
          <h2 class="settings-section-title">Training</h2>
          <span class="config-label">Standard-Schlüssel</span>
          <select id="settingDefaultClef" class="config-select settings-default-clef"></select>
          <span class="config-label">Tagesziel (Übungen)</span>
          <input type="number" id="settingDailyGoal" min="5" max="100" class="config-input" />
        </div>
        <div class="md:col-span-2 settings-actions">
          <button id="saveSettingsBtn" class="btn-action btn-primary">Einstellungen speichern</button>
          <p id="settingsStatus" class="settings-status"></p>
        </div>
      </div>
    </div>
  </section>

</div>

<script type="module" src="./src/js/main.js"></script>
</body>
</html>
